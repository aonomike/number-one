$(function(){"use strict";var a=Backbone.Model.extend({defaults:{artist:"",title:"",videoId:""},getVideoId:function(){var a=this,b=this.get("artist")+"+"+this.get("title");$.ajax({url:"https://www.googleapis.com/youtube/v3/search",data:{part:"snippet",type:"video",videoEmbeddable:"true",maxResults:"1",key:"AIzaSyA5UichqO_WSK22RMjGqWhmz-GvRQK9Szg",q:b},type:"GET",success:function(b){a.set("videoId",b.items[0].id.videoId),a.trigger("change:[videoId]")}})}}),b=Backbone.Collection.extend({model:a,url:"https://number-oneapp.herokuapp.com/api/records"}),c=new b,d=Backbone.View.extend({el:"#main",events:{"submit #dateEntry":"submit"},initialize:function(){this.$record=this.$("#record"),this.$player=this.$("#player"),this.listenTo(c,"sync",this.addModel)},render:function(a){var b=new e({model:a});return this.$record.html(b.render().el),this},submit:function(b){b.preventDefault();var d=$("#dateEntry").serializeArray()[0].value,e=new a({id:d});c.add(e),e.fetch({success:function(a,b,c){a.getVideoId()}})},addModel:function(a){this.render(this.collection.last())},renderVideo:function(a){var a=a;this.player?this.player.cueVideoById(a):this.setupPlayer(a),$("body").animate({scrollTop:$("body").height()},1e3)},setupPlayer:function(a){var b=document.createElement("script"),c=this,a=a;b.src="https://www.youtube.com/iframe_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d),window.onYouTubeIframeAPIReady=function(){c.player=new YT.Player("player",{height:"390",width:"640",videoId:a})}}}),e=Backbone.View.extend({tagName:"h2",template:_.template("<%= artist %>: <%= title %>"),initialize:function(){this.model.on("change:[videoId]",this.callVideo,this)},callVideo:function(){f.renderVideo(this.model.get("videoId"))},render:function(){var a=this.model.toJSON();return this.$el.html(this.template(a)),this}}),f=new d({collection:c})}),$(function(){$("#date").combodate({minYear:1952,format:"YYYY-MM-DD"})});